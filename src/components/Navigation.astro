---
interface Props {
  currentPath?: string;
}

const { currentPath = "/" } = Astro.props;

const links = [
  { href: "/", label: "About" },
  { href: "/research/", label: "Research" },
  { href: "/projects/", label: "Side Projects" },
  { href: "/cv/", label: "CV" },
];

function isActive(href: string, current: string): boolean {
  if (href === "/") return current === "/";
  return current.startsWith(href);
}
---

<nav class="nav">
  {links.map((link, i) => (
    <>
      {i > 0 && <span class="nav-separator">|</span>}
      <a
        href={link.href}
        class:list={[{ active: isActive(link.href, currentPath) }]}
      >
        {link.label}
      </a>
    </>
  ))}

  <button class="theme-toggle" id="theme-toggle" aria-label="Toggle dark mode">
    <!-- Sun icon (shown in dark mode) -->
    <svg class="sun-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" style="display: none;">
      <path d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM5.99 4.58a.996.996 0 00-1.41 0 .996.996 0 000 1.41l1.06 1.06c.39.39 1.03.39 1.41 0s.39-1.03 0-1.41L5.99 4.58zm12.37 12.37a.996.996 0 00-1.41 0 .996.996 0 000 1.41l1.06 1.06c.39.39 1.03.39 1.41 0a.996.996 0 000-1.41l-1.06-1.06zm1.06-10.96a.996.996 0 000-1.41.996.996 0 00-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06zM7.05 18.36a.996.996 0 000-1.41.996.996 0 00-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06z"/>
    </svg>
    <!-- Moon icon (shown in light mode) -->
    <svg class="moon-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
      <path d="M12 3a9 9 0 109 9c0-.46-.04-.92-.1-1.36a5.389 5.389 0 01-4.4 2.26 5.403 5.403 0 01-3.14-9.8c-.44-.06-.9-.1-1.36-.1z"/>
    </svg>
  </button>
</nav>

<script>
  const toggle = document.getElementById('theme-toggle');
  const sunIcon = toggle?.querySelector('.sun-icon') as HTMLElement;
  const moonIcon = toggle?.querySelector('.moon-icon') as HTMLElement;

  function updateIcons() {
    const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
    if (sunIcon && moonIcon) {
      sunIcon.style.display = isDark ? 'block' : 'none';
      moonIcon.style.display = isDark ? 'none' : 'block';
    }
  }

  updateIcons();

  toggle?.addEventListener('click', () => {
    const current = document.documentElement.getAttribute('data-theme');
    const next = current === 'dark' ? 'light' : 'dark';
    document.documentElement.setAttribute('data-theme', next);
    localStorage.setItem('theme', next);
    updateIcons();
  });
</script>
