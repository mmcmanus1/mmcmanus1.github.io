---
import PageLayout from '../layouts/PageLayout.astro';
import { getCollection } from 'astro:content';

const papers = await getCollection('papers');
const sortedPapers = papers.sort((a, b) =>
  new Date(b.data.date).getTime() - new Date(a.data.date).getTime()
);

function formatDate(date: Date): string {
  return date.toLocaleDateString('en-US', { year: 'numeric', month: 'short' });
}
---

<PageLayout title="Research" description="Research papers and publications by Matt McManus">
  <h2>Papers</h2>

  {sortedPapers.map((paper) => (
    <article class="paper">
      <h3 class="paper-title">
        <a href={paper.data.paperUrl} target="_blank" rel="noopener">
          {paper.data.title}
        </a>
      </h3>
      <p class="paper-date">{formatDate(paper.data.date)}</p>
      <p class="paper-excerpt">{paper.data.excerpt}</p>
      <div class="paper-links">
        <a href={paper.data.paperUrl} target="_blank" rel="noopener">
          Paper
        </a>
        {paper.data.slidesUrl && (
          <a href={paper.data.slidesUrl} target="_blank" rel="noopener">
            Slides
          </a>
        )}
      </div>
    </article>
  ))}
</PageLayout>
